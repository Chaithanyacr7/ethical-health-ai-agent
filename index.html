<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Friendly MBBS AI</title>
    <link rel="stylesheet" href="./index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css"
    />
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.run/@google/genai",
    "marked": "https://esm.run/marked@12.0.2",
    "highlight.js": "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/es/highlight.min.js"
  }
}
</script>
    <script type="module" src="./index.tsx"></script>
  </head>
  <body>
    <header>
      <h1>Friendly MBBS AI</h1>
    </header>
    <main class="chat-container" id="chat-container" role="log" aria-live="polite">
      <div class="message model-message">
        <div class="message-content">
          <p>
            Welcome to Friendly MBBS AI! I'm here to provide general health and wellness information. You can ask me questions, upload a photo of a medication box, or even a patient leaflet (PDF).
          </p>
          <p>
            <b>New!</b> Try generating an image by typing a description (e.g., "an artistic illustration of a healthy heart") and clicking the âœ¨ icon.
          </p>
          <p>
            <b>Important:</b> I am an AI assistant, not a doctor. My advice is for informational purposes only. Please consult a licensed medical professional for diagnosis or treatment.
          </p>
        </div>
      </div>
    </main>

    <div class="input-container">
      <form id="chat-form" class="chat-form">
        <div id="input-row" class="input-row">
          <div class="file-preview" id="file-preview" hidden></div>
          <button type="button" class="upload-btn" id="upload-btn" aria-label="Attach file">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v11.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"></path></svg>
          </button>
          <input type="file" id="file-upload" accept="image/*,application/pdf" hidden />
          
          <button type="button" class="voice-btn" id="camera-btn" aria-label="Open camera">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><circle cx="12" cy="12" r="3.2"/><path d="M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
          </button>

          <button type="button" class="voice-btn" id="voice-btn" aria-label="Start voice input">
            <svg class="mic-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3zm5.5 9.5a5.5 5.5 0 0 1-11 0H4a8 8 0 0 0 7 7.93V21h2v-2.07A8 8 0 0 0 20 10.5h-2.5z"/></svg>
            <svg class="stop-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24" hidden><path d="M6 6h12v12H6z"></path></svg>
          </button>

          <div class="visualizer-container" id="visualizer-container">
            <canvas id="voice-visualizer"></canvas>
            <div class="visualizer-controls" id="visualizer-controls" hidden>
              <button type="button" id="mute-btn" class="mute-btn" aria-label="Mute">
                <svg class="unmuted-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M3.63 3.63c-.39.39-.39 1.02 0 1.41L7.29 8.7 7 9H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h3l5 5V17.29l2.06 2.06c-.28.14-.58.24-.9.31-.03.01-.06.02-.1.02-.38 0-.72-.21-.89-.54l-1.58-3.15c-.29-.58-1.1-.58-1.39 0L12 17l-3-3H6v-2h3l3 3 1.29-1.29L3.63 3.63zM19 12c0 .82-.15 1.61-.41 2.34l1.53 1.53c.56-1.17.88-2.48.88-3.87 0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zm-7-8l-1.88 1.88L12 7.76V4l-5 5h1.7l1.3 1.3L12 12l5-5h-2V4z"></path></svg>
                <svg class="muted-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20" hidden><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zM19 12c0 .82-.15 1.61-.41 2.34l1.53 1.53c.56-1.17.88-2.48.88-3.87 0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L7 9H4v6h3l5 5V4z"></path></svg>
              </button>
              <input type="range" id="volume-slider" min="0" max="2" value="1" step="0.1" aria-label="Adjust microphone sensitivity" />
            </div>
          </div>

          <textarea id="prompt-input" rows="1" placeholder="Ask about wellness or medications..."></textarea>
          <button type="button" id="image-gen-btn" class="submit-btn image-gen-btn" aria-label="Generate image">
            <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M11,6V4.5c0-0.28,0.22-0.5,0.5-0.5s0.5,0.22,0.5,0.5V6h1.5c0.28,0,0.5,0.22,0.5,0.5S13.78,7,13.5,7H12v1.5 c0,0.28-0.22,0.5-0.5,0.5S11,8.78,11,8.5V7H9.5C9.22,7,9,6.78,9,6.5S9.22,6,9.5,6H11z M18,2c-0.55,0-1,0.45-1,1v1 c-0.28,0-0.5,0.22-0.5,0.5S16.22,5,16.5,5H17v0.5c0,0.28,0.22,0.5,0.5,0.5s0.5-0.22,0.5-0.5V5h0.5c0.28,0,0.5-0.22,0.5-0.5 S18.78,4,18.5,4H18V3C18,2.45,17.55,2,17,2z M12,11.5c-0.28,0-0.5,0.22-0.5,0.5v1h-1c-0.28,0-0.5,0.22-0.5,0.5s0.22,0.5,0.5,0.5 h1v1c0,0.28,0.22,0.5,0.5,0.5s0.5-0.22,0.5-0.5v-1h1c0.28,0,0.5-0.22,0.5-0.5s-0.22-0.5-0.5-0.5h-1v-1 C12.5,11.72,12.28,11.5,12,11.5z M19.5,11c-1.3,0-2.4,0.83-2.82,2h-1.35c-0.41-1.17-1.51-2-2.82-2s-2.4,0.83-2.82,2H8.32 C7.9,11.83,6.8,11,5.5,11C3.57,11,2,12.57,2,14.5S3.57,18,5.5,18c1.52,0,2.81-0.95,3.29-2.28C9.24,15.26,9.81,15,10.5,15 c0.67,0,1.25,0.24,1.7,0.64c0.18,0.18,0.42,0.28,0.67,0.28c0.12,0,0.24-0.02,0.36-0.07c0.41,1.17,1.51,2,2.82,2 c1.93,0,3.5-1.57,3.5-3.5S17.43,11,15.5,11c-0.67,0-1.25,0.24-1.7,0.64c-0.18,0.18-0.42,0.28-0.67,0.28c-0.12,0-0.24-0.02-0.36-0.07 C12.35,12.26,11.78,12,11.18,12c-0.69,0-1.28,0.28-1.72,0.72C9.05,12.28,8.58,12,8,12c-1.38,0-2.5,1.12-2.5,2.5S6.62,17,8,17 c0.9,0,1.67-0.49,2.11-1.22c0.26-0.08,0.5-0.23,0.7-0.42c0.48-0.48,0.78-1.12,0.78-1.85s-0.3-1.37-0.78-1.85 C10.33,10.73,9.24,10,8,10c-2.21,0-4,1.79-4,4s1.79,4,4,4c1.6,0,2.97-0.95,3.58-2.28c0.45,0.18,0.94,0.28,1.45,0.28 c1.93,0,3.5-1.57,3.5-3.5s-1.57-3.5-3.5-3.5c-0.51,0-0.99,0.11-1.42,0.29C13.03,9.95,11.66,9,10,9c-2.21,0-4,1.79-4,4s1.79,4,4,4 c0.9,0,1.67-0.49,2.11-1.22c0.26-0.08,0.5-0.23,0.7-0.42C13.29,14.88,14.32,15,15.5,15c1.38,0,2.5-1.12,2.5-2.5 S16.88,10,15.5,10c-0.9,0-1.67,0.49-2.11,1.22c-0.26,0.08-0.5,0.23-0.7,0.42C12.21,11.12,11.18,11,10,11c-1.38,0-2.5,1.12-2.5,2.5 s1.12,2.5,2.5,2.5c0.58,0,1.08-0.2,1.49-0.51C14.37,16.42,15.35,17,16.5,17c2.21,0,4-1.79,4-4s-1.79-4-4-4H19.5z"/></svg>
          </button>
          <button type="submit" id="submit-btn" class="submit-btn" aria-label="Send message">
            <svg class="send-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
            <div class="loader" role="status" aria-label="Loading" hidden></div>
          </button>
        </div>
      </form>
    </div>

    <!-- Camera Modal -->
    <div id="camera-modal" class="camera-modal" hidden>
      <div class="camera-modal-content">
        <video id="camera-view" class="camera-view" autoplay playsinline></video>
        <canvas id="camera-canvas" hidden></canvas>
        <div class="camera-controls">
          <button type="button" id="capture-btn" class="capture-btn" aria-label="Take picture"></button>
          <button type="button" id="close-camera-btn" class="close-camera-btn" aria-label="Close camera">&times;</button>
        </div>
      </div>
    </div>
  </body>
</html>